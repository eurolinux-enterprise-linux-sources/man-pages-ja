.\" Copyright (c) 1991 The Regents of the University of California.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @(#)exec.3	6.4 (Berkeley) 4/19/91
.\"
.\" Converted for Linux, Mon Nov 29 11:12:48 1993, faith@cs.unc.edu
.\" Updated more for Linux, Tue Jul 15 11:54:18 1997, pacman@cqc.com
.\" Modified, 24 Jun 2004, Michael Kerrisk <mtk.manpages@gmail.com>
.\"     Added note on casting NULL
.\"
.\" Japanese Version Copyright (c) 1998 Masato Taruishi
.\"         all rights reserved.
.\" Translated 1998-05-27, Masato Taruishi
.\" Modified 1998-08-08, Fujiwara Teruyoshi <fujiwara@linux.or.jp>
.\" Modified 2000-10-06, Kentaro Shirakata <argrath@ub32.org>
.\" Modified 2005-02-26, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>
.\"
.\"WORD:        null-terminated strings    NULLで終わる文字列
.\"WORD:        anti-Trojan-horse measure  トロイの木馬対策
.\"WORD:	external variable          外部変数
.\"WORD:        current  directory first   カレントディレクトリが最初
.\"WORD:        the attempted execve       呼び出そうとしたexecve
.\"WORD:        variadic function          可変長引き数関数
.\"WORD:        semantics                  (プログラムの)動作
.\"
.TH EXEC 3  2009-02-22 "GNU" "Linux Programmer's Manual"
.SH 名前
execl, execlp, execle, execv, execvp \- ファイルを実行する
.SH 書式
.B #include <unistd.h>
.sp
.B extern char **environ;
.sp
.BI "int execl(const char *" path ", const char *" arg ", ...);"
.br
.BI "int execlp(const char *" file ", const char *" arg ", ...);"
.br
.BI "int execle(const char *" path ", const char *" arg ,
.br
.BI "           ..., char * const " envp "[]);"
.br
.BI "int execv(const char *" path ", char *const " argv "[]);"
.br
.BI "int execvp(const char *" file ", char *const " argv "[]);"
.SH 説明
.BR exec ()
ファミリーの関数は現在のプロセスイメージを新しいプロセスイメージで置き
換える。このマニュアルで説明されている関数は
.BR execve (2)
のフロントエンドである。
(現在のプロセスイメージの置き換えについての詳細は
.BR execve (2)
のマニュアルを参照)
.PP
これらの関数の最初の引き数は、実行されるファイルのパス名である。
.PP
関数
.BR execl (),
.BR execlp (),
.BR execle ()
の
.I "const char *arg"
とそれに続く省略部分は
.IR arg0 ,
.IR arg1 ,
\&...,
.I argn
とみなされる。
これらには、実行されるプログラムで利用可能な引き数のリストを指定する
(引き数のリストは NULL で終端された文字列へのポインタから構成される)。
慣習として、最初の引き数は、実行されるファイル名
へのポインタにする。引き数のリストは必ず NULL
で終わらなければならず、これらの関数は可変長引き数関数なので、
このポインタは
.I "(char *) NULL"
とキャストしなければならない。
.PP
関数
.BR execv ()
と
.BR execvp ()
は、利用可能な引き数リスト (NULL で終端された文字列への
ポインタの配列) を新しいプログラムに渡す。
慣習として、最初の引き数は実行されるファイル名へ
のポインタにする。ポインタの配列は必ず
NULL で終わらなければならない。
.PP
関数
.BR execle ()
では新しいプロセスの環境も指定する。
環境は引き数リスト (引き数リストもしくは追加の引き数を持った
.I argv
配列へのポインタ) の最後の NULL ポインタに続けて指定する。
追加の引き数は、NULL で終端された文字列へのポインタの配列であり、
NULL ポインタで終わらなければならない。
他の関数では、現在のプロセスの外部変数
.B environ
から新しいプロセス用の環境を与える。
.SS execlp() と execvp() の特別な動作
.PP
関数
.BR execlp ()
と
.BR execvp ()
は、指定されたファイル名がスラッシュ (/) を含んでいない場合、
シェルと同じ動作で実行可能なファイルを探索する。
検索パスは環境変数
.B PATH
で指定されたパスである。
この変数が指定されていない場合、デフォルトPATHとして
":/bin:/usr/bin" が使用される。
また、いくつかのエラーが発生した場合の扱いが特殊である。
.PP
もしファイルが実行ファイルでない場合 (このとき呼び出そうとした
.BR execve (2)
はエラー
.B EACCES
で失敗する)、これらの関数は残りの検索パスの検索を続ける。
他にファイルが見つからなくなった場合
.I errno
に
.B EACCES
を設定し復帰する。
.\" fujiwara: 個人的には「復帰する」の方が好き(^_^;
.PP
ファイルのヘッダが実行形式として認識できない場合
(このとき呼び出そうとした
.BR execve (2)
はエラー
.B ENOEXEC
で失敗する)、これらの関数はそのファイルを最初の引き数としたシェル
.RI ( /bin/sh )
を実行する (これにも失敗した場合、これ以上の検索は行われない)。
.SH 返り値
もし
.BR exec ()
ファミリーが復帰してきた場合、エラーが発生している。
返り値は \-1 で、
.I errno
にそのエラーの内容がセットされる。
.SH エラー
これら全ての関数は失敗する場合がある。その場合ライブラリ関数
.BR execve (2)
によって指定されたエラーを
.I errno
に設定する。
.SH 準拠
POSIX.1-2001.
.SH 注意
Linux 以外のシステムには、
(環境変数 \fBPATH\fR が定義されていないときの)
デフォルトのパスにおいて、カレント・ディレクトリが
.I /bin
と
.I /usr/bin
の後ろに配置されるものもある。
これはトロイの木馬対策のためである。
Linux では、デフォルトのパスに、昔ながらの「現在のディレクトリを
先に探索」というルールを使っている。
.PP
ファイルを実行しようとしている間にエラーが発生した時の
.BR execlp ()
と
.BR execvp ()
のふるまいについて歴史的な慣習はあるが、伝統的に文書として記載されておらず、
POSIX 標準でも規定されていない。BSD (またおそらく他のシステム) では、
.B ETXTBSY
が発生した場合、自動的に中断 (sleep) し再試行を行う。
Linux はそれをハードエラーとして取り扱い即座に復帰する。
.PP
伝統的に、関数
.BR execlp ()
と
.BR execvp ()
は、上で説明したエラーと、これら 2 つの関数自身が返す
.B ENOMEM
と
.B E2BIG
以外の全てのエラーを無視していたが、
今では、上で説明した以外のエラーが発生した場合でも、
返ってくるよう変更された。
.SH 関連項目
.BR sh (1),
.BR execve (2),
.BR fork (2),
.BR ptrace (2),
.BR fexecve (3),
.BR environ (7)
