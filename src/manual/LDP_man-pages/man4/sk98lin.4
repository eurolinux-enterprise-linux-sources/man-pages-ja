.\" (C)Copyright 1999-2003 Marvell(R) -- linux@syskonnect.de
.\" sk98lin.4 1.1 2003/12/17 10:03:18
.\" This manpage can be viewed using `groff -Tascii -man sk98lin.4 | less`
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111,
.\" USA.
.\"
.\" Japanese Version Copyright (c) 2004 Yuichi SATO
.\"         all rights reserved.
.\" Translated 2004-10-09, Yuichi SATO <ysato444@yahoo.co.jp>
.\" Modified 2007-06-05, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>, LDP v2.51
.\"
.\"WORD:	autonegotiation	自動設定
.\"WORD:	interrupt moderation	割り込み調停
.\"
.TH SK98LIN 4 2007-11-25 "Linux" "Linux Programmer's Manual"
.SH 名前
sk98lin \- Marvell/SysKonnect ギガビットイーサネットドライバ v6.21
.SH 書式
.B insmod sk98lin.o
.RB [ Speed_A=\c
.IR i,j,... ]
.RB [ Speed_B=\c
.IR i,j,... ]
.RB [ AutoNeg_A=\c
.IR i,j,... ]
.RB [ AutoNeg_B=\c
.IR i,j,... ]
.RB [ DupCap_A=\c
.IR i,j,... ]
.RB [ DupCap_B=\c
.IR i,j,... ]
.RB [ FlowCtrl_A=\c
.IR i,j,... ]
.RB [ FlowCtrl_B=\c
.IR i,j,... ]
.RB [ Role_A=\c
.IR i,j,... ]
.RB [ Role_B=\c
.IR i,j,... ]
.RB [ ConType=\c
.IR i,j,... ]
.RB [ Moderation=\c
.IR i,j,... ]
.RB [ IntsPerSec=\c
.IR i,j,... ]
.RB [ PrefPort=\c
.IR i,j,... ]
.RB [ RlmtMode=\c
.IR i,j,... ]
.SH 説明
.ad l
.hy 0
.B sk98lin
は Marvell と SysKonnect のネットワークアダプタカードの
ギガビットイーサネットドライバである。
これは SysKonnect SK-98xx/SK-95xx 互換のギガビットイーサネットアダプタと
Yukon 互換のチップセットをサポートしている。

insmod を使ってドライバをロードする際、
ネットワークアダプタカードのパラメータを
コンマで区切られたコマンドの列として指定することができる。
2 つのネットワークアダプタが取り付けられている時に、
例えば、1 つ目のアダプタのポート A の自動ネゴシエーションは ON にするが、
2 つ目のアダプタのポート A は OFF にする場合は、
以下のように入力すればよい:

   insmod sk98lin.o AutoNeg_A=On,Off

.B sk98lin
が 1 つ以上のアダプタカードに関連づけられていて、
かつ
.I /proc
ファイルシステムがシステムにマウントされている場合、
取り付けられているネットワークアダプタカードの全てのポートについて、
(ポート単位に) 専用の統計ファイルがフォルダ
.I /proc/net/sk98lin
に作られる。
これらのファイルは
.I eth[x]
という名前であり、
.I x
はインタフェースの番号である。
この番号はシステムによってポート毎に割り当てられたものである。

ロードが完了すると、
.BR ifconfig (8)
コマンドを使って、各
.I eth[x]
インタフェースに希望する IP アドレスを割り当てることができる。
これによりアダプタがイーサネットに接続され、
コンソールに状態メッセージが表示される。
このメッセージでは、
"ethx: network connection up using port y" の後に
設定されたり検出された接続パラメータが表示される。

.B sk98lin
はラージフレーム (ジャンボフレームとも呼ばれる) もサポートする。
ジャンボフレームを使うと、大量のデータを転送する際に、
スループットを大幅に向上させることができる。
ラージフレームを有効にするには、
インタフェースの MTU (maximum transfer unit, 最大転送単位) サイズを
大きな値に設定すればよい。
デフォルトの MTU サイズは 1500 であり、
最大で 9000 (バイト) まで設定することができる。
MTU サイズを設定するのは、
インタフェースに IP アドレスを割り当てるときにもできるし、後から
.BR ifconfig (8)
コマンドに mtu 引き数を指定することで設定することもできる。
例えば、eth0 に IP アドレスとラージフレーム MTU サイズを
割り当てたい場合、以下の 2 つのコマンドを実行すればよい:

    ifconfig eth0 10.1.1.1
    ifconfig eth0 mtu 9000

これらの 2 つのコマンドは 1 つにまとめることもできる:

    ifconfig eth0 10.1.1.1 mtu 9000

ラージフレームを使用できるのは、ネットワーク環境全体で
ラージフレームの使用が認められている場合のみである点に注意すること。
つまり、イーサネットで使われている全てのスイッチでも
ラージフレームがサポートされていなければならない。
多くのスイッチがラージフレームをサポートしてはいるが、
設定を行う必要がある。
多くの場合、デフォルトの設定では標準フレーム
(1500 バイトの MTU サイズ) だけしかサポートしない。
ネットワーク内のスイッチに加え、
使用される全てのネットワークアダプタでも
ジャンボフレームが有効になっていなければならない。
アダプタがラージフレームを受け取るように設定されていない場合、
アダプタはそのフレームを単純に捨ててしまう。

標準のイーサネットフレームサイズに戻すのは、再び
.BR ifconfig (8)
コマンドを使えばよい:

    ifconfig eth0 mtu 1500

Linux の Marvell/SysKonnect ギガビットイーサネットドライバは、
IEEE 規格 802.1, 802.1q, 802.3ad に準拠する
VLAN と Link Aggregation に対応している。
これらの機能は、インターネットにあるオープンソースモジュールを
インストールした後でのみ利用可能である:

.IR VLAN \c
: http://www.candelatech.com/~greear/vlan.html
.br
.I Link
.IR Aggregation \c
: http://www.st.rim.or.jp/~yumo

.br
Marvell/SysKonnect は、これらのオープンソースモジュールに対するサポートは
行っておらず、これらを使った場合に生じるいかなる失敗や問題についても
責任を負わない点に注意すること。
.SS 引き数
.TP
.BI Speed_A= i,j,...
このパラメータはアダプタカードのポート A がサポートするリンク速度を
設定するのに使われる。これは Yukon copper アダプタでのみ有効である。
使用可能な値は以下の通り:
.IR 10 ,
.IR 100 ,
.IR 1000 ,
.IR Auto 。
デフォルトは
.I Auto
である。
通常、リンク速度はリンクの確立時に 2 つのポートの間で自動設定される。
これに失敗した場合、ポートはこの引き数で指定された設定になる。
.TP
.BI Speed_B= i,j,...
このパラメータはアダプタカードのポート B がサポートするリンク速度を
設定するのに使われる。これは Yukon copper アダプタでのみ有効である。
使用可能な値は以下の通り:
.IR 10 ,
.IR 100 ,
.IR 1000 ,
.IR Auto 。
デフォルトは
.I Auto
である。
通常、リンク速度はリンクの確立時に 2 つのポートの間で自動設定される。
これに失敗した場合、ポートはこの引き数で指定された設定になる。
.TP
.BI AutoNeg_A= i,j,...
アダプタカードのポート A の自動設定 (autonegotiation) の使用を
有効または無効にする。使用可能な値は以下の通り:
.IR On ,
.IR Off ,
.IR Sense 。
デフォルトは
.I On
である。
.I Sense
モードはリンクパートナが自動設定をサポートしているか否かを
自動的に検知する。
.TP
.BI AutoNeg_B= i,j,...
アダプタカードのポート B の自動設定 (autonegotiation) の使用を
有効または無効にする。使用可能な値は以下の通り:
.IR On ,
.IR Off ,
.IR Sense 。
デフォルトは
.I On
である。
.I Sense
モードはリンクパートナが自動設定をサポートしているか否かを
自動的に検知する。
.TP
.BI DupCap_A= i,j,...
この引き数はアダプタカードのポート A で使う二重通信 (duplex) モードを示す。
使用可能な値は以下の通り:
.IR Half ,
.IR Full ,
.IR Both 。
デフォルトは
.I Both
である。
この引き数はポート A の AutoNeg_A が
.I Sense
に設定されていない場合にのみ有効である。
AutoNeg_A が
.I On
の場合、DupCap_A の 3 つの値
.RI ( Half ,
.IR Full ,
.IR Both )
のうちどれでも指定することができる。
AutoNeg_A が
.I Off
の場合、DupCap_A の値
.I Full
と
.I Half
のみを指定することができる。
この DupCap_A 引き数は、リンクパートナが全ての二重通信の組み合わせを
サポートしていない場合に役に立つ。
.TP
.BI DupCap_B= i,j,...
この引き数はアダプタカードのポート B で使う二重通信モードを示す。
使用可能な値は以下の通り:
.IR Half ,
.IR Full ,
.IR Both 。
デフォルトは
.I Both
である。
この引き数はポート B の AutoNeg_B が
.I Sense
に設定されていない場合にのみ有効である。
AutoNeg_B が
.I On
の場合、DupCap_B の 3 つの値
.RI ( Half ,
.IR Full ,
.IR Both )
のうちどれでも指定することができる。
AutoNeg_B が
.I Off
の場合、DupCap_B の値
.I Full
と
.I Half
のみを指定することができる。
この DupCap_B 引き数は、リンクパートナが全ての二重通信の組み合わせを
サポートしていない場合に役に立つ。
.TP
.BI FlowCtrl_A= i,j,...
この引き数は自動設定時にポートが対向に伝える
フロー制御機能を設定する。
使用可能な値は以下の通り:
.IR Sym ,
.IR SymOrRem ,
.IR LocSend ,
.IR None 。
デフォルトは
.I SymOrRem
である。
それぞれのモードには以下のような意味がある:

.br
.I Sym
= Symmetric
 リンクパートナの双方が PAUSE フレームを送ることができる。
.br
.I SymOrRem
= SymmetricOrRemote
 リンクパートナの双方またはリモートパートナのみが
PAUSE フレームを送ることができる。
.br
.I LocSend
= LocalSend
 ローカルリンクパートナのみが PAUSE フレームを送ることができる。
.br
.I None
= None
 リンクパートナのどちらも PAUSE フレームを送ることはできない。

このパラメータは AutoNeg_A が
.I Off
の場合には無視される点に注意すること。
.TP
.BI FlowCtrl_B= i,j,...
この引き数は自動設定時にポートが対向に伝える
フロー制御機能を設定する。
使用可能な値は以下の通り:
.IR Sym ,
.IR SymOrRem ,
.IR LocSend ,
.IR None 。
デフォルトは
.I SymOrRem
である。
それぞれのモードには以下のような意味がある:

.I Sym
= Symmetric
 リンクパートナの双方が PAUSE フレームを送ることができる。
.br
.I SymOrRem
= SymmetricOrRemote
 リンクパートナの双方またはリモートパートナのみが
PAUSE フレームを送ることができる。
.br
.I LocSend
= LocalSend
 ローカルリンクパートナのみが PAUSE フレームを送ることができる。
.br
.I None
= None
 リンクパートナのどちらも PAUSE フレームを送ることはできない。
.br

このパラメータは AutoNeg_B が
.I Off
の場合には無視される点に注意すること。
.TP
.BI Role_A= i,j,...
この引き数は 1000Base-T アダプタカードでのみ有効である。
2 つの 1000Base-T ポートが通信する場合、
片方が (タイミング情報を提供する) マスタの役割をしなければならず、
もう片方がスレーブにならなければならない。
使用可能な値は以下の通り:
.IR Auto ,
.IR Master ,
.IR Slave 。
デフォルトは
.I Auto
である。
通常、ポートの役割は 2 つのポートでリンクを確立するときに自動設定される。
自動設定に失敗した場合、
アダプタカードのポート A はこの引き数で指定された設定になる。
.TP
.BI Role_B= i,j,...
この引き数は 1000Base-T アダプタカードでのみ有効である。
2 つの 1000Base-T ポートが通信する場合、
片方が (タイミング情報を提供する) マスタの役割をしなければならず、
もう片方がスレーブにならなければならない。
使用可能な値は以下の通り:
.IR Auto ,
.IR Master ,
.IR Slave 。
デフォルトは
.I Auto
である。
通常、ポートの役割は 2 つのポートでリンクを確立するときに自動設定される。
自動設定に失敗した場合、
アダプタカードのポート B はこの引き数で指定された設定になる。
.TP
.BI ConType= i,j,...
この引き数は、ポート毎に指定する、全部で 5 個の引き数の組み合わせを、
1 つの引き数にしたものである。
これによりアダプタカードの 2 つのポートの設定を簡略化できる。
この変数のそれぞれの値は、
ポート引き数の最も意味のある組み合わせを反映したものである。
使用可能な値とそれに対応するポート毎のパラメータの組み合わせは、
以下の通り:

.nf
ConType | DupCap   AutoNeg   FlowCtrl   Role   Speed
--------+-------------------------------------------
\fIAuto\fP    |  Both      On      SymOrRem   Auto   Auto
.br
\fI100FD\fP   |  Full      Off       None     Auto   100
.br
\fI100HD\fP   |  Half      Off       None     Auto   100
.br
\fI10FD\fP    |  Full      Off       None     Auto   10
.br
\fI10HD\fP    |  Half      Off       None     Auto   10

.fi
その他のポート引き数を
.I ConType
引き数と組み合わせて指定すると、それらの設定を結合した設定となる。
これは、ポート毎の引き数 (例えば
.IR Speed_A )
の方が組み合わせ変数
.I ConType
より優先順位が高いためである。
.TP
.BI Moderation= i,j,...
割り込み調停 (interrupt moderation) は、ドライバが処理を開始しなければ
ならない割り込み回数の最大値を設定するために使用される。
つまり、ドライバが処理を行うまで、1回以上の割り込み
(送信または受信パケットが処理されること) がキューに入れられる。
キューに入れられた割り込みがいつ処理されるかは、
以下で説明する
.I IntsPerSec
引き数で決定される。
使用可能な調停モードは以下の通り:
.IR None ,
.IR Static ,
.IR Dynamic 。
デフォルトは
.I None
である。
それぞれのモードは以下の意味を持つ:

.I None
アダプタカードに対して割り込み調停を適用しない。
よって送信または受信割り込みは、
アダプタカードの割り込み線に現れると直ぐに処理される。

.br
.I Static
アダプタカードに対して割り込み調停が適用される。
全ての送信または受信割り込みは、調停間隔が完全に終わるまで
キューに入れられる。
この調停間隔が終わると、キューに入れられた全ての割り込みは、
1個の大きな塊として遅延なく処理される。
.I Static
という用語は、あるインタフェースに現在どれだけの
ネットワーク負荷がかかっているかに関わらず、
割り込み調停が常に有効になることを表している。
さらに、調停間隔の時間は固定で、ドライバが動作している間は変化しない。

.br
.I Dynamic
システムの負荷に応じて、アダプタカードに対して割り込み調停が適用される。
ドライバがシステムの負荷が高すぎると検出した場合、
割り込み調停を有効にすることにより、
過剰なネットワーク負荷からシステムを保護しようとする。
\(em その後に \(em CPU 利用率が再び下がった場合
(またはネットワーク負荷が極わずかになった場合)、
割り込み調停は自動的に無効にされる。

ドライバが扱わなければならないインタフェースのうち
ネットワーク負荷が高いものが 1 つ以上あり、
\(em その結果 \(em  CPU 利用率が高くなっている場合、
割り込み調停を使うべきである。
ネットワーク負荷が高い状況で調停が適用されると、
遅いコンピュータでは CPU 負荷が 20-30% 削減されるだろう。

割り込み調停を使うことの欠点として、
往復遅延時間 (round-trip-time, RTT) の増加がある点に注意すること。
これは、割り込みがキューに入れられ、まとめて処理されるためである。
.TP
.BI IntsPerSec= i,j,...
この引き数は割り込み調停の間隔を決定する。
静的 (static) 割り込み調停が使われている場合、
.I IntsPerSec
引き数の値が 2000 であれば、割り込み調停の間隔は 500 ミリ秒になる。
この引き数に設定可能な値は 30...40000 の範囲で、
これは 1 秒毎の割り込み回数である。
デフォルト値は 2000 である。

この引き数は静的 (static) または動的 (dynamic) 割り込み調停が
有効になっているときにのみ使用される。
この引き数は割り込み調停が適用されていない場合には無視される。

調停間隔の期間は注意して選ぶこと。
一見したところでは、とても長い期間 (例えば 1 秒間に 100 回だけの割り込み) を
選ぶことに意味があるように見えるかもしれないが、そうすると
パケット処理の遅延が激しく増加する。
一方で、とても短い調停時間を選ぶと、割り込み調停を使う意味がなくなってしまう。
.TP
.BI PrefPort= i,j,...
この引き数は (2 ポートのネットワークアダプタで)
優先 (preferred) ポートを A または B のどちらにするかを指定するのに使われる。
優先ポートとは、A と B の両方のポートが完全に機能していると検知された場合に
使用されるポートである。
使用可能な値は以下の通り:
.I A
または
.IR B 。
デフォルトは
.I A
である。
.TP
.BI RlmtMode= i,j,...
RLMT はポートの状態を監視する。
アクティブなポートのリンクが落ちた場合、
RLMT は即時に待機しているリンクに切り替える。
少なくとも 1 つの「物理的」リンクが起動するまでは、仮想リンクが維持される。
この引き数は RLMT が両方のポートをどのように監視するかを決める。
使用可能な値は以下の通り:
.IR CheckLinkState ,
.IR CheckLocalPort ,
.IR CheckSeg ,
.IR DualNet 。
デフォルトは
.I CheckLinkState
である。
各モードは以下のような意味を持つ。

.I CheckLinkState
リンク状態のチェックのみ:
RLMT は、各ポートについてアダプタハードウェアが報告するリンク状態を使い、
そのポートが全てのネットワークトラフィックを送受信するのに使用可能かを
決定する。

.br
.I CheckLocalPort
このモードでは、RLMT はアダプタカードの 2 つのポートの間で
定期的にパケットを交換することにより、
2 つのポートの間のネットワーク経路を監視する。
このモードでは 2 つのポートが互いに「見える」ような
ネットワーク設定が必要である
(つまり、ポート間にルータがあってはならない)。

.br
.I CheckSeg
ローカルポートとセグメントをチェックする。
このモードは CheckLocalPort モードと同じ機能を提供し、
更にポート間のネットワークセグメントをチェックする。
よって、このモードはネットワーク上に
スパニングツリープロトコル (Spanning Tree protocol) を
使うように設定されたギガビットイーサネットスイッチが
設置されている場合にのみ使用できる。

.br
.I DualNet
このモードでは、ポート A と B が別々のデバイスとして使用される。
2 ポートのアダプタを持っている場合、ポート A を
.I eth[x]
に、ポート B を
.I eth[x+1]
に設定することができる。
2 つのポートは別々の IP アドレスを付けて独立に使用することができる。
優先ポートの設定は使用されない。
RLMT は無効にされる。

RLMT モード
.I CheckLocalPort
と
.I CheckLinkState
は、1 つのアダプタ上のポート間でネットワーク経路があるような設定で
動作するように設計されている。
さらに、このモードはアダプタ同士が直結 (back-to-back) で
接続されている状態で動作するようには設計されていない。
.SH ファイル
.TP
.I /proc/net/sk98lin/eth[x]
.br
アダプタカードの特定のインタフェースの統計ファイル。
このファイルには、アダプタカードの一般的な情報と、
全ての送信・受信カウンタの詳細な一覧が含まれる。
.TP
.I /usr/src/linux/Documentation/networking/sk98lin.txt
.br
.I sk98lin
ドライバの
.I README
ファイルである。
これには詳細なインストール HOWTO が含まれており、
ドライバの全ての引き数が記述されている。
また一般的な問題とその解決法についても書かれている。
.SH バグ
バグは linux@syskonnect.de に報告してほしい。
.\" .SH 著者
.\" Ralph Roesler \(em rroesler@syskonnect.de
.\" .br
.\" Mirko Lindner \(em mlindner@syskonnect.de
.SH 関連項目
.BR insmod (8),
.BR ifconfig (8),
.BR modprobe (8)
