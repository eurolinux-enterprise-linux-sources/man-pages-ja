.\" This manpage has been automatically generated by docbook2man
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/>
.\" Please send any bug reports, improvements, comments, patches,
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.\"
.\" Japanese Version Copyright (C) 2005 Suzuki Takashi
.\"         all rights reserved.
.\" Translated Sun Jul 10 22:56:20 JST 2005
.\"         by Suzuki Takashi <JM@linux.or.jp>.
.\"
.\"WORD:        insert          登録する
.\"
.TH "MODPROBE.CONF" "5" "1 June 2005" "" ""

.SH "名前"
modprobe.conf, modprobe.d \- modprobe の設定ファイル・ディレクトリ
.SH "説明"
.PP
\fBmodprobe\fR コマンドはモジュールの依存関係に応じて
複数のモジュールを追加したり削除したりできるため、
これらのモジュールにどのオプションを使うかを指定する手段が必要である。
\fI/etc/modprobe.conf\fR (または \fI/etc/modprobe.conf\fR が存在しない場合、
\fI/etc/modprobe.d\fR ディレクトリ以下のすべてのファイル) は
必要に応じてこれらのオプションを指定する。
また、便利なようにエイリアス (モジュールの別名) を作成するためにも用いられる。
最後に、
(複数のモジュールを登録するなどの) 特別な要求に応えるために、
\fBmodprobe\fR の通常の振る舞いを完全に無効にして乗っ取ることができる。
.PP
モジュール名やエイリアス名には (他のモジュール名と同様に)
\- や _ を含めることができる。
ここで、 \- と _ はすべてのモジュールコマンドにおいて、
互いに入れ替え可能である (区別されない) ことに注意。
.PP
\fImodprobe.conf\fR や \fImodprobe.d\fR 以下のファイルの形式は単純である。
1 行に 1 コマンドで、
空行と # で始まる行は無視される (コメントを追加するのに使える) 。
行末の \\ は次の行に続くことを意味し、これを使えばファイルが少し見やすくなる。
.PP
書式は 2.4 以前のカーネルで使われていた \fImodules.conf\fR を
簡単にしたものである。
.SH "コマンド"
.TP
\fBalias \fIwildcard\fB \fImodulename\fB \fR
モジュールの別名を付ける。
例えば、 "alias my-mod really_long_modulename" とすると、
"modprobe really_long_modulename" の代わりに
"modprobe my-mod" を使うことができる。
シェル形式のワイルドカードも使うことができ、
"alias my-mod* really_long_modulename" とすると
"modprobe my-mod-something" も同じ効果となる。
他のエイリアスに対するエイリアスを設定することはできない
(正しく動作しない) が、
エイリアスにオプションを設定することができ、
それらは他のオプションに追加される。
モジュールはそれ自身にエイリアスを持つことができる点に注意。
それらは \fBmodinfo\fR で見ることができる。
これらのエイリアスは最後の望みとして使われる
(つまり、その名前の実モジュールもなく、設定ファイル中に
その名前の \fBinstall\fR, \fBremove\fR, \fBalias\fR コマンドが
存在しない場合に使われる) 。
.TP
\fBoptions \fImodulename\fB \fIoption...\fB \fR
このコマンドで
モジュール \fImodulename\fR (エイリアスも可) に
オプションを追加することができる。
ここで設定されたオプションは
カーネルに登録される際に毎回使われ、
(\fBmodprobe\fR \fImodulename\fR で) 直接登録される場合にも
そのモジュールに依存するモジュールと一緒に登録される場合にも
使われる。

モジュール自身に対する \fBoption\fR 、
エイリアスに対する \fBoption\fR 、
コマンドラインのオプションは、
全てのオプションがいっしょに渡される。
.TP
\fBinstall \fImodulename\fB \fIcommand...\fB \fR
\fImodprobe.conf\fR の中でもっとも強力なコマンドである。
\fBmodprobe\fR は、
通常はカーネルにモジュールを登録するが、
install コマンドを記述すると、
代わりにここで指定された command を実行する。
command はどんなシェルコマンドでもよい。
そのため、どんな複雑な処理でも思いどおりに指定できる。
例えば、モジュール "fred" が、
"barney" がインストールされている状態のほうが
うまく動作する (が依存関係にないので
\fBmodprobe\fR が自動的にロードしない) 場合、
"install fred /sbin/modprobe barney;
/sbin/modprobe --ignore-install fred" と書けば、
望みどおりのことをさせることができる。
ここで、 \fB--ignore-install\fR は
2 番目の \fBmodprobe\fR が同じ \fBinstall\fR コマンドを
再び実行しないようにするためのものである。
\fBremove\fR も参照。

\fBinstall\fR を使って、
実際には存在しないモジュールを作ることもできる。
例えば、
"install probe-ethernet /sbin/modprobe e100 ||
/sbin/modprobe eepro100" と書けば、
"modprobe probe-ethernet" としたときに、
まず e100 ドライバを試し、次に eepro100 を試す。

コマンドの中で "$CMDLINE_OPTS" という文字列を使うと、
modprobe のコマンドラインで指定したオプションに置き換えられる。
これを使うと、
設定ファイルに install コマンドが存在していても、
ユーザは "modprobe fred opt=1" というコマンドラインで
モジュールに "opt=1" というオプションを渡すことができ、便利である。
つまり、上の例では設定ファイルに
"install
fred /sbin/modprobe barney; /sbin/modprobe
--ignore-install fred $CMDLINE_OPTS" のように書けばよい。
.TP
\fBremove \fImodulename\fB \fIcommand...\fB \fR
上の \fBinstall\fR コマンドと同様であるが、
"modprobe -r" が呼び出されたときに実行される。
上の 2 つの例を削除にあてはめると、
"remove fred /sbin/modprobe -r --ignore-remove fred &&
/sbin/modprobe -r barney" および
"remove probe-ethernet
/sbin/modprobe -r eepro100 || /sbin/modprobe -r e100" のようになる。
.TP
\fBinclude \fIfilename\fB \fR
このコマンドを使うと、
他の設定ファイルまたはディレクトリ全体を読み込むことができ、
これが便利なこともある。
読み込まれたファイル中のエイリアスは
現在のファイルで定義されたエイリアスを上書きすることに注意。
.TP
\fBblacklist \fImodulename\fB \fR
モジュールはそれ自身にエイリアスを持つことができる。
通常、これらは "pci:123..." といったように、
サポートするデバイスを表すエイリアスである。
これらの「内部」エイリアスは
通常の "alias" キーワードで上書きすることができる。
しかし、 2 つ以上のモジュールが同じデバイスをサポートする場合や、
モジュールがサポートしないデバイスをサポートするとしている場合もある。
このような場合、 \fBblacklist\fR キーワードを使って、
あるモジュールのすべての内部エイリアスを無視させることができる。
.SH "下位互換性"
.PP
現在の (2.4 または 2.2 の) モジュール設定から
\fImodprobe.conf\fR を生成してくれる
\fBgenerate_modprobe.conf\fR というプログラムがある。
.PP
書式は以前の \fI/etc/modules.conf\fR と似ているが、
多くの機能が削除されている。
これには 2 つの理由がある:
まず、 install および remove コマンドでほとんど何でもできる。
二つ目に、 module-init-tools の modprobe は
他のツールで簡単に置き換えることができるよう、
十分単純になるように設計されている。
.PP
実際のモジュールの登録の複雑さが
3 つのシステムコール (open, read, init_module) で軽減され、
\fImodules.dep\fR ファイルが単純でオープンであるおかげで、
もし必要があればもっと強力な改良版の modprobe を作ることも可能である。
.SH "著作権"
.PP
このマニュアルページの著作権表示は Copyright 2004, Rusty Russell, IBM Corporation.
.SH "関連項目"
.PP
\fBmodprobe\fR(8),
\fBmodules.dep\fR(5)
